<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>List of all users</title>
    <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>

    <script>
        function getListUsers() {
            const stompClient = Stomp.over(new SockJS('/gs-guide-websocket'));
            stompClient.connect({}, (frame) => {
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/response', (dtoUser) => addUserToTable(JSON.parse(dtoUser.body).name, JSON.parse(dtoUser.body).login));
            });
        }

        const addUserToTable = (name, login) => $("#listUsers").append("<tr><td>" + name + "</td><td>" + login + "</td></tr>")
    </script>

    <style type="text/css">
        body {
            padding: 40px;
        }

        h3 {
            background: url("../listmark.png") no-repeat;
            padding: 2px;
            padding-left: 30px;
        }
    </style>
</head>
<body onload="getListUsers();">
<h3>Пользователи:</h3>
<br>
<div class="row">
    <div class="col-md-12">
        <table id="conversation" class="table table-striped">
            <thead>
            <tr>
                <th>Name</th>
                <th>Login</th>
            </tr>
            </thead>
            <tbody id="listUsers">
            <tr th:each="dtoUser : ${dtoUsers}">
                <td th:text="${dtoUser.name}">1</td>
                <td th:text="${dtoUser.login}">John Doe</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<br>
<a th:href="@{/user/create}" href="userCreate.html" target="_blank">Add new user</a>

</body>
</html>
